name: Build for production
on:
  deployment:
  workflow_dispatch:

jobs:
  build:
    name: Buid & Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@master

      - name: Setup Environment
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.4'

      - name: Install Composer Packages
        run: composer install --no-dev

      - name: Install Node Packages
        uses: actions/setup-node@v2-beta
        with:
          node-version: '22'
          check-latest: true

      - name: Install NPM dependencies
        run: npm install

      - name: Compile assets for production
        run: npm run build

      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build
          path: |
            !.*
            !CLAUDE.md
            !AGENTS.md
            app/**
            bootstrap/**
            public/**
            resources/**
            routes/**
            config/**
            vendor/**
            node_modules/**
            artisan.php
            composer.json
            composer.lock
            package.json
            package-lock.json
            README.md

          if-no-files-found: error
          overwrite: true